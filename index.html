<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Elevator Watch | Vigilancia de Elevadores</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --success-green: #198754;
        --danger-red: #dc3545;
      }
      body {
        background-color: #f4f7f6;
        color: #212529;
      }
      /* High Accessibility Styling */
      .status-card {
        border-left: 12px solid;
        border-radius: 8px;
        transition: all 0.3s ease;
      }
      .btn-xl {
        padding: 1.25rem;
        font-size: 1.4rem;
        font-weight: 800;
        border-radius: 12px;
      }
      .history-item {
        border-left: 4px solid #dee2e6;
        margin-bottom: 5px;
      }
      .history-fail {
        border-left-color: var(--danger-red);
      }
      .history-success {
        border-left-color: var(--success-green);
      }
      #success-toast {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: none;
        z-index: 2000;
        width: 90%;
        max-width: 400px;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-dark bg-dark sticky-top shadow">
      <div class="container d-flex justify-content-between">
        <span class="navbar-brand fw-bold">ElevatorWatch</span>
        <button
          class="btn btn-warning fw-bold px-3"
          onclick="toggleLanguage()"
          id="langBtn"
        >
          ESPA√ëOL
        </button>
      </div>
    </nav>

    <div class="container py-4">
      <div id="screen-dashboard">
        <div class="mb-4">
          <h1
            class="h3 fw-bold mb-1"
            data-en="Building Status"
            data-es="Estado del Edificio"
          >
            Building Status
          </h1>
          <p
            class="text-muted"
            data-en="123 Main St. | Updated live"
            data-es="123 Main St. | Actualizado en vivo"
          >
            123 Main St. | Updated live
          </p>
        </div>

        <div id="elevator-container">
          <div
            class="card mb-3 status-card shadow-sm"
            id="card-A"
            style="border-left-color: var(--success-green)"
          >
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <h2
                  class="h5 mb-0 fw-bold"
                  data-en="Elevator A"
                  data-es="Elevador A"
                >
                  Elevator A
                </h2>
                <span
                  class="badge bg-success p-2 fs-6 status-badge"
                  data-en="RUNNING"
                  data-es="FUNCIONANDO"
                  >RUNNING</span
                >
              </div>
            </div>
          </div>

          <div
            class="card mb-3 status-card shadow-sm"
            id="card-B"
            style="border-left-color: var(--success-green)"
          >
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h2
                    class="h5 mb-0 fw-bold"
                    data-en="Elevator B"
                    data-es="Elevador B"
                  >
                    Elevator B
                  </h2>
                  <small
                    class="text-muted meta-text"
                    data-en="Stable Service"
                    data-es="Servicio Estable"
                    >Stable Service</small
                  >
                </div>
                <span
                  class="badge bg-success p-2 fs-6 status-badge"
                  data-en="RUNNING"
                  data-es="FUNCIONANDO"
                  >RUNNING</span
                >
              </div>
              <button
                id="fix-btn-B"
                class="btn btn-outline-success w-100 mt-3 fw-bold"
                style="display: none"
                onclick="verifyFix('B')"
              >
                <span data-en="‚úÖ It's working now" data-es="‚úÖ Ya funciona"
                  >‚úÖ It's working now</span
                >
              </button>
            </div>
          </div>
        </div>

        <button
          class="btn btn-danger w-100 btn-xl shadow my-4"
          onclick="showReporting()"
        >
          <span data-en="+ REPORT A PROBLEM" data-es="+ REPORTAR UNA FALLA"
            >+ REPORT A PROBLEM</span
          >
        </button>

        <div class="text-center mb-4">
          <button
            class="btn btn-link text-decoration-none fw-bold"
            data-bs-toggle="modal"
            data-bs-target="#guideModal"
          >
            <span
              data-en="üìñ How to use this data for change"
              data-es="üìñ C√≥mo usar estos datos para el cambio"
            >
              üìñ How to use this data for change
            </span>
          </button>
        </div>

        <div class="card border-0 shadow-sm mb-4 bg-dark text-white">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h3
                class="h6 mb-0 text-uppercase fw-bold text-warning"
                data-en="30-Day Performance"
                data-es="Rendimiento de 30 D√≠as"
              >
                30-Day Performance
              </h3>
              <span class="badge bg-danger" data-en="POOR" data-es="DEFICIENTE"
                >POOR</span
              >
            </div>

            <div class="row align-items-center">
              <div class="col-8">
                <div
                  class="progress mb-2"
                  style="height: 10px; background-color: #444"
                >
                  <div
                    class="progress-bar bg-warning"
                    role="progressbar"
                    style="width: 42%"
                    aria-valuenow="42"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  ></div>
                </div>
                <small class="text-secondary">
                  <span
                    data-en="Total Building Uptime: "
                    data-es="Tiempo Total Funcionando: "
                    >Total Building Uptime:
                  </span>
                  <strong class="text-white">42%</strong>
                </small>
              </div>
              <div class="col-4 text-end">
                <button
                  class="btn btn-sm btn-outline-light"
                  onclick="alert('Downloading PDF Report...')"
                >
                  üìÑ PDF
                </button>
              </div>
            </div>

            <hr class="my-3 border-secondary" />

            <div class="row text-center small">
              <div class="col-6 border-end border-secondary">
                <div class="fw-bold fs-5">18</div>
                <div
                  class="text-secondary"
                  data-en="Days Down"
                  data-es="D√≠as Ca√≠dos"
                >
                  Days Down
                </div>
              </div>
              <div class="col-6">
                <div class="fw-bold fs-5">4.2h</div>
                <div
                  class="text-secondary"
                  data-en="Avg. Repair"
                  data-es="Reparaci√≥n Prom."
                >
                  Avg. Repair
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card border-0 shadow-sm mb-4 bg-white">
          <div class="card-body">
            <h3
              class="h6 fw-bold text-muted text-uppercase mb-3"
              data-en="Top Management Excuses"
              data-es="Excusas Comunes de la Administraci√≥n"
            >
              Top Management Excuses
            </h3>

            <div class="d-flex justify-content-between align-items-center mb-2">
              <span
                class="small fw-bold"
                data-en="Waiting on parts"
                data-es="Esperando piezas"
                >Waiting on parts</span
              >
              <span class="badge rounded-pill bg-light text-dark"
                >12 Times</span
              >
            </div>
            <div class="progress mb-3" style="height: 6px">
              <div class="progress-bar bg-info" style="width: 70%"></div>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-2">
              <span
                class="small fw-bold"
                data-en="Technician scheduled"
                data-es="T√©cnico programado"
                >Technician scheduled</span
              >
              <span class="badge rounded-pill bg-light text-dark">5 Times</span>
            </div>
            <div class="progress mb-3" style="height: 6px">
              <div class="progress-bar bg-info" style="width: 30%"></div>
            </div>

            <div class="bg-light p-2 rounded mt-3">
              <p class="small mb-0 text-center italic">
                <i
                  data-en="AI Note: 'Waiting on parts' has been used for 65% of outages this year."
                  data-es="Nota de IA: 'Esperando piezas' se ha usado en el 65% de las fallas este a√±o."
                >
                  AI Note: 'Waiting on parts' has been used for 65% of outages
                  this year.
                </i>
              </p>
            </div>
          </div>
        </div>

        <div class="mt-4">
          <h3
            class="h6 fw-bold text-uppercase text-muted"
            data-en="Recent Activity"
            data-es="Actividad Reciente"
          >
            Recent Activity
          </h3>
          <div id="history-log" class="bg-white rounded shadow-sm p-2">
            <div
              class="p-3 text-center text-muted small"
              data-en="No reports in the last 24 hours."
              data-es="No hay reportes en las √∫ltimas 24 horas."
            >
              No reports in the last 24 hours.
            </div>
          </div>
        </div>
      </div>

      <div id="screen-report" style="display: none">
        <button
          class="btn btn-link p-0 mb-4 text-decoration-none fw-bold"
          onclick="showDashboard()"
        >
          ‚Üê <span data-en="Back" data-es="Atr√°s">Back</span>
        </button>

        <div class="card shadow-sm border-0 p-3 mb-4">
          <h3
            class="h4 fw-bold mb-4"
            data-en="Report a Failure"
            data-es="Reportar una Falla"
          >
            Report a Failure
          </h3>

          <label
            class="form-label fw-bold"
            data-en="1. Which elevator?"
            data-es="1. ¬øQu√© elevador?"
            >1. Which elevator?</label
          >
          <div class="row g-2 mb-4">
            <div class="col-6">
              <input
                type="radio"
                class="btn-check"
                name="el-sel"
                id="selA"
                autocomplete="off"
              /><label
                class="btn btn-outline-dark w-100 py-3 fw-bold"
                for="selA"
                >A</label
              >
            </div>
            <div class="col-6">
              <input
                type="radio"
                class="btn-check"
                name="el-sel"
                id="selB"
                autocomplete="off"
                checked
              /><label
                class="btn btn-outline-dark w-100 py-3 fw-bold"
                for="selB"
                >B</label
              >
            </div>
          </div>

          <label
            class="form-label fw-bold"
            data-en="2. What is the issue?"
            data-es="2. ¬øQu√© pasa?"
            >2. What is the issue?</label
          >
          <div class="list-group mb-4">
            <button
              class="list-group-item list-group-item-action py-3 fw-bold"
              onclick="submitReport('B', 'Out of Service', 'Fuera de servicio')"
            >
              ‚ùå
              <span data-en="Out of Service" data-es="Fuera de servicio"
                >Out of Service</span
              >
            </button>
            <button
              class="list-group-item list-group-item-action py-3 fw-bold"
              onclick="submitReport('B', 'Doors Stuck', 'Puertas trabadas')"
            >
              ‚ÜîÔ∏è
              <span data-en="Doors Stuck" data-es="Puertas trabadas"
                >Doors Stuck</span
              >
            </button>
            <button
              class="list-group-item list-group-item-action py-3 fw-bold"
              onclick="
                submitReport('B', 'Uneven / Shaking', 'Est√° chueco / Tiembla')
              "
            >
              ‚ö†Ô∏è
              <span data-en="Uneven / Shaking" data-es="Est√° chueco / Tiembla"
                >Uneven / Shaking</span
              >
            </button>
          </div>

          <label
            class="form-label fw-bold mt-3"
            data-en="3. What did management say?"
            data-es="3. ¬øQu√© dijo la administraci√≥n?"
            >3. What did management say?</label
          >
          <select class="form-select mb-4" id="mgmt-excuse">
            <option
              value=""
              data-en="No explanation given"
              data-es="Sin explicaci√≥n"
            >
              No explanation given
            </option>
            <option
              value="parts"
              data-en="Waiting on parts"
              data-es="Esperando piezas"
            >
              Waiting on parts
            </option>
            <option
              value="tech"
              data-en="Technician on the way"
              data-es="T√©cnico en camino"
            >
              Technician on the way
            </option>
            <option
              value="vandalism"
              data-en="Vandalism/Misuse"
              data-es="Vandalismo/Mal uso"
            >
              Vandalism/Misuse
            </option>
          </select>

          <!-- <div class="bg-light p-3 rounded text-center">
            <button class="btn btn-primary rounded-pill px-4 fw-bold">
              üéôÔ∏è
              <span data-en="Voice Report" data-es="Reportar por voz"
                >Voice Report</span
              >
            </button>
          </div> -->
          <div class="row g-2 mb-4 text-center">
            <p
              class="text-muted small mb-2 w-100"
              data-en="AI-Enhanced Proof"
              data-es="Pruebas con IA"
            >
              AI-Enhanced Proof
            </p>

            <div class="col-6">
              <button
                class="btn btn-outline-primary w-100 py-3 rounded-4 shadow-sm h-100"
              >
                <div class="fs-3">üéôÔ∏è</div>
                <div class="small fw-bold" data-en="Voice" data-es="Voz">
                  Voice
                </div>
              </button>
            </div>

            <div class="col-6">
              <button
                class="btn btn-outline-primary w-100 py-3 rounded-4 shadow-sm h-100"
                onclick="document.getElementById('mediaUpload').click()"
              >
                <div class="fs-3">üì∏</div>
                <div
                  class="small fw-bold"
                  data-en="Photo/Video"
                  data-es="Foto/Video"
                >
                  Photo/Video
                </div>
              </button>
              <input
                type="file"
                id="mediaUpload"
                accept="image/*,video/*"
                capture="environment"
                style="display: none"
                onchange="handleMediaSelect()"
              />
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      id="success-toast"
      class="alert alert-dark shadow text-white border-0 py-3"
    >
      <div class="d-flex align-items-center">
        <span class="fs-3 me-3">üëç</span>
        <strong id="toast-msg">Success!</strong>
      </div>
    </div>

    <div class="modal fade" id="guideModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content border-0 shadow-lg">
          <div class="modal-header bg-dark text-white">
            <h5
              class="modal-title fw-bold"
              data-en="Resident Action Guide"
              data-es="Gu√≠a de Acci√≥n para Residentes"
            >
              Resident Action Guide
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body p-4">
            <section class="mb-4">
              <h6
                class="fw-bold text-primary"
                data-en="1. Be the Witness"
                data-es="1. Sea el Testigo"
              >
                1. Be the Witness
              </h6>
              <p
                class="small text-muted"
                data-en="Every report you make is a legal record. If the elevator is down, report it immediately. If it's fixed, verify it."
                data-es="Cada reporte que usted hace es un registro legal. Si el elevador no sirve, rep√≥rtelo de inmediato. Si ya funciona, verif√≠quelo."
              >
                Every report you make is a legal record. If the elevator is
                down, report it immediately. If it's fixed, verify it.
              </p>
            </section>

            <section class="mb-4">
              <h6
                class="fw-bold text-primary"
                data-en="2. Use the 'Receipts'"
                data-es="2. Use los Comprobantes"
              >
                2. Use the 'Receipts'
              </h6>
              <p
                class="small text-muted"
                data-en="Take a screenshot of the 'Accountability Summary.' Use the Uptime % when calling 311 or the Management Office."
                data-es="Tome una captura de pantalla del 'Resumen de Rendimiento'. Use el % de tiempo funcionando cuando llame al 311 o a la Administraci√≥n."
              >
                Take a screenshot of the 'Accountability Summary.' Use the
                Uptime % when calling 311 or the Management Office.
              </p>
            </section>

            <section>
              <h6
                class="fw-bold text-danger"
                data-en="3. Escalate"
                data-es="3. Escale la Denuncia"
              >
                3. Escalate
              </h6>
              <ul class="small text-muted ps-3">
                <li
                  data-en="Call 311 and provide the 'Days Down' count from this app."
                  data-es="Llame al 311 y proporcione el conteo de 'D√≠as Ca√≠dos' de esta app."
                >
                  Call 311 and provide the 'Days Down' count from this app.
                </li>
                <li
                  data-en="Send the PDF report to your local City Council member."
                  data-es="Env√≠e el reporte en PDF a su concejal local."
                >
                  Send the PDF report to your local City Council member.
                </li>
              </ul>
            </section>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary w-100 fw-bold"
              data-bs-dismiss="modal"
              data-en="Got it"
              data-es="Entendido"
            >
              Got it
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // --- STATE MANAGEMENT ---
      let currentLang = "en"
      // historyData stores objects: { en: "", es: "", isFail: bool, time: "", hasMedia: bool }
      let historyData = []
      // Mock data for the excuse tracker
      let excuseCounts = { parts: 12, tech: 5, vandalism: 2 }

      // --- CORE UI FUNCTIONS ---
      function toggleLanguage() {
        currentLang = currentLang === "en" ? "es" : "en"

        // 1. Update all static text with [data-en] and [data-es] attributes
        document.querySelectorAll("[data-en]").forEach((el) => {
          el.innerText = el.getAttribute(`data-${currentLang}`)
        })

        // 2. Update the Toggle Button text
        document.getElementById("langBtn").innerText =
          currentLang === "en" ? "ESPA√ëOL" : "ENGLISH"

        // 3. Re-render the History Feed (instant translation)
        renderHistory()

        // 4. Update dynamic elements like badges and cards
        updateDynamicElements()
      }

      function showReporting() {
        document.getElementById("screen-dashboard").style.display = "none"
        document.getElementById("screen-report").style.display = "block"
        window.scrollTo(0, 0)
      }

      function showDashboard() {
        document.getElementById("screen-report").style.display = "none"
        document.getElementById("screen-dashboard").style.display = "block"
      }

      // --- MEDIA HANDLING ---
      function handleMediaSelect() {
        const fileInput = document.getElementById("mediaUpload")
        if (fileInput.files.length > 0) {
          showToast(
            currentLang === "en"
              ? "Media attached! üì∏"
              : "¬°Archivo adjunto! üì∏",
          )
        }
      }

      // --- LOGIC: REPORTING AN ISSUE ---
      function submitReport(id, msgEn, msgEs) {
        const card = document.getElementById(`card-${id}`)
        const badge = card.querySelector(".status-badge")
        const fixBtn = document.getElementById(`fix-btn-${id}`)
        const excuseSelect = document.getElementById("mgmt-excuse")
        const fileInput = document.getElementById("mediaUpload")

        // 1. Update Card UI to Failure State
        card.style.borderLeftColor = "var(--danger-red)"
        badge.className = "badge bg-danger p-2 fs-6 status-badge text-uppercase"
        badge.setAttribute("data-en", "OUT OF SERVICE")
        badge.setAttribute("data-es", "FUERA DE SERVICIO")
        badge.innerText =
          currentLang === "en" ? "OUT OF SERVICE" : "FUERA DE SERVICIO"
        fixBtn.style.display = "block"

        // 2. Check for media
        const hasMedia = fileInput.files.length > 0

        // 3. Process Excuse Selection
        const selectedExcuse = excuseSelect.value
        if (selectedExcuse) {
          excuseCounts[selectedExcuse]++
          // In a real app, we'd re-render the excuse bar chart here
        }

        // 4. Update the "Days Down" counter (Mock increment)
        const daysDownEl = document.getElementById("days-down-count")
        if (daysDownEl) {
          daysDownEl.innerText = parseInt(daysDownEl.innerText) + 1
        }

        // 5. Add to Data Store and Reset
        addToLog(
          `Elevator ${id}: ${msgEn}`,
          `Elevador ${id}: ${msgEs}`,
          true,
          hasMedia,
        )

        fileInput.value = "" // Clear file
        excuseSelect.value = "" // Reset dropdown

        showToast(
          currentLang === "en"
            ? "Report Logged for Advocacy!"
            : "¬°Datos Guardados para Denuncia!",
        )
        showDashboard()
      }

      // --- LOGIC: VERIFYING A FIX ---
      function verifyFix(id) {
        const card = document.getElementById(`card-${id}`)
        const badge = card.querySelector(".status-badge")
        const fixBtn = document.getElementById(`fix-btn-${id}`)

        card.style.borderLeftColor = "var(--success-green)"
        badge.className =
          "badge bg-success p-2 fs-6 status-badge text-uppercase"
        badge.setAttribute("data-en", "RUNNING")
        badge.setAttribute("data-es", "FUNCIONANDO")
        badge.innerText = currentLang === "en" ? "RUNNING" : "FUNCIONANDO"
        fixBtn.style.display = "none"

        addToLog(
          `Elevator ${id}: Verified working`,
          `Elevador ${id}: Verificado funcionando`,
          false,
          false,
        )
        showToast(
          currentLang === "en" ? "Status Updated!" : "¬°Estado Actualizado!",
        )
      }

      // --- LOGIC: HISTORY MANAGEMENT ---
      function addToLog(en, es, isFail, hasMedia) {
        const now = new Date()
        const timeStr = now.toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        })

        historyData.unshift({ en, es, isFail, time: timeStr, hasMedia })
        renderHistory()
      }

      function renderHistory() {
        const logContainer = document.getElementById("history-log")

        if (historyData.length === 0) {
          const emptyText =
            currentLang === "en"
              ? "No reports in the last 24 hours."
              : "No hay reportes en las √∫ltimas 24 horas."
          logContainer.innerHTML = `<div class="p-3 text-center text-muted small">${emptyText}</div>`
          return
        }

        logContainer.innerHTML = historyData
          .map((item) => {
            const mediaIcon = item.hasMedia
              ? `<span class="ms-1" title="Photo Attached">üì∏</span>`
              : ""
            const label = currentLang === "en" ? item.en : item.es
            return `
                <div class="p-3 border-bottom history-item ${item.isFail ? "history-fail" : "history-success"}">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="fw-bold small">${label}${mediaIcon}</span>
                        <span class="text-muted" style="font-size: 0.7rem">${item.time}</span>
                    </div>
                </div>
            `
          })
          .join("")
      }

      function updateDynamicElements() {
        // Keeps badges updated if language is toggled while an elevator is "Down"
        document.querySelectorAll(".status-badge").forEach((badge) => {
          if (badge.hasAttribute(`data-${currentLang}`)) {
            badge.innerText = badge.getAttribute(`data-${currentLang}`)
          }
        })
      }

      // --- UI: NOTIFICATIONS ---
      function showToast(msg) {
        const toast = document.getElementById("success-toast")
        const msgEl = document.getElementById("toast-msg")
        if (msgEl) msgEl.innerText = msg
        toast.style.display = "block"
        setTimeout(() => {
          toast.style.display = "none"
        }, 2500)
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
